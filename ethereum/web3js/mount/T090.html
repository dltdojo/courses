<!DOCTYPE html>
<html lang="zh-hant-TW">

<head>
    <meta charset="UTF-8">
    <title>web3.js</title>
    <style>
        body {
            width: 35em;
            margin: 0 auto;
        }
    </style>
     <!-- <script src="https://cdn.rawgit.com/ethereum/web3.js/1.0/dist/web3.min.js"></script> -->
     <!-- https://github.com/ethereum/web3.js/issues/960 -->
     <!-- master version : 0.20.1 -->
     <!-- <script src="https://rawgit.com/ethereum/web3.js/master/dist/web3.js"></script> -->
    <script src="/dweb3js/web3-0.20.1.js"></script>
    <script type="text/javascript">
        var web3 = new Web3()
        //
        // geth dev mode 8545
        // testrcp port 18545
        // 
        web3.setProvider(new web3.providers.HttpProvider("http://" + window.location.hostname + ":8545"))
        // web3.setProvider(new web3.providers.HttpProvider("http://" + window.location.hostname + ":18545"))
        // ABI
        var coinContract = web3.eth.contract([{ "constant": true, "inputs": [], "name": "minter", "outputs": [{ "name": "", "type": "address" }], "payable": false, "type": "function" }, { "constant": true, "inputs": [{ "name": "", "type": "address" }], "name": "balances", "outputs": [{ "name": "", "type": "uint256" }], "payable": false, "type": "function" }, { "constant": false, "inputs": [{ "name": "receiver", "type": "address" }, { "name": "amount", "type": "uint256" }], "name": "mint", "outputs": [], "payable": false, "type": "function" }, { "constant": false, "inputs": [{ "name": "receiver", "type": "address" }, { "name": "amount", "type": "uint256" }], "name": "send", "outputs": [], "payable": false, "type": "function" }, { "inputs": [], "payable": false, "type": "constructor" }, { "anonymous": false, "inputs": [{ "indexed": false, "name": "from", "type": "address" }, { "indexed": false, "name": "to", "type": "address" }, { "indexed": false, "name": "amount", "type": "uint256" }], "name": "Sent", "type": "event" }]);
        //
        // CHANGE THE TWO ADDRESSES FIRST
        // 
        var addressContract = "0x17df34aea5a44b304dbe40c093c7e31f621510f2"
        var addressUser = "0xd9cc64ee3900a06c95aa5ecaeeac28b07b83055e"
        var coin = coinContract.at(addressContract)
        // 
        // MetaMask injected web3 issue
        // 
        var myweb3 = web3
        var lastMintTxHash
        
        function ethAccounts(){
            // https://github.com/ethereum/wiki/wiki/JavaScript-API#web3ethaccounts
            console.log("sync", myweb3.eth.accounts)
            myweb3.eth.getAccounts(function(err, result){
                console.log("aync", err, result )
            })
        }
        
        function balances() {
            // https://github.com/ethereum/wiki/wiki/JavaScript-API#contract-methods
            console.log(coin.balances(addressUser).toNumber())
        }

        function mint() {
            // https://github.com/ethereum/wiki/wiki/JavaScript-API#contract-methods
            // param1, param2, {value: 200, gas: 2000}, function(err, result){ ... }
            coin.mint(addressUser,1999,{value:0, from:addressUser},function(err,result){
                console.log(err, result);
                lastMintTxHash = result;
            })
        }

        function getTransactionReceipt(){
            // https://github.com/ethereum/wiki/wiki/JavaScript-API#web3ethgettransactionreceipt
            var receipt = myweb3.eth.getTransactionReceipt(lastMintTxHash)
            console.log(receipt)
        }
    </script>
</head>

<body>
    <h1>T090 Web3 0.20.1</h1>
    <div>
        <p><button onclick="ethAccounts()">web3.eth.accounts</button></p>
        <p><button onclick="balances()">coin.at() ,  coin.balances(account0)</button></p>
        <p><button onclick="mint()">1. coin.mint(account0, 1999)</button></p>
        <p><button onclick="getTransactionReceipt()">2. getTransactionReceipt(lastMintTxHash)</button></p>
    </div>
    <script>
    </script>
</body>

</html>